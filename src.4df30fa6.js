parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"B0rW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Decode=exports.Encode=void 0;var e=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function a(a){for(var f=new Uint8Array(a),c=f.length,d=new Array(c),b=0;b<c;b++)d[b]=e[f[b]];return d.join("")}function f(e){var a=e.length;if(a%2!=0)throw Error("Length of string must be a multiple of 2");for(var f=new Uint8Array(a/2),c=0;c<a/2;c++)f[c]=parseInt(e[2*c]+e[2*c+1],16);return f.buffer}exports.Encode=a,exports.Decode=f;
},{}],"XCns":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function a(e){try{u(i.next(e))}catch(t){s(t)}}function o(e){try{u(i.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,o)}u((i=i.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,i,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(o){s=[6,o],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function r(e){void 0===e&&(e=window.crypto),this.keyParams={name:"RSA-OAEP",hash:"SHA-512",size:4096},this.kdfParams={name:"PBKDF2",hash:"SHA-512",iterations:1e4},this.userKeyParams={name:"AES-GCM",length:256},this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder("utf8"),this.cryptoAPI=e}return r.prototype.clear=function(){this.keypair=void 0,this.userKey=void 0},r.prototype.hasKeyPair=function(){return void 0!==this.keypair&&!!this.keypair.publicKey&&!!this.keypair.privateKey},r.prototype.hasUserKey=function(){return!!this.userKey},r.prototype.getInternalState=function(){return{keypair:this.keypair,userKey:this.userKey}},r.prototype.generateSalt=function(){return this.cryptoAPI.getRandomValues(new Uint8Array(16))},r.prototype.importPassword=function(r){return e(this,void 0,Promise,function(){return t(this,function(e){return[2,this.cryptoAPI.subtle.importKey("raw",this.textEncoder.encode(r),this.kdfParams.name,!1,["deriveKey","deriveBits"])]})})},r.prototype.deriveUserKey=function(r,i,n){return e(this,void 0,Promise,function(){var e,r;return t(this,function(t){switch(t.label){case 0:return[4,this.importPassword(i)];case 1:return e=t.sent(),r=this,[4,this.cryptoAPI.subtle.deriveKey({name:this.kdfParams.name,hash:this.kdfParams.hash,iterations:this.kdfParams.iterations,salt:n},e,{name:this.userKeyParams.name,length:this.userKeyParams.length},!1,["wrapKey","unwrapKey"])];case 2:return r.userKey=t.sent(),[2]}})})},r.prototype.generateKeyPair=function(){return e(this,void 0,Promise,function(){var e;return t(this,function(t){switch(t.label){case 0:return e=this,[4,this.cryptoAPI.subtle.generateKey({name:this.keyParams.name,hash:this.keyParams.hash,modulusLength:this.keyParams.size,publicExponent:new Uint8Array([1,0,1])},!0,["encrypt","decrypt"])];case 1:return e.keypair=t.sent(),[2]}})})},r.prototype.exportPublicKey=function(){return e(this,void 0,Promise,function(){var e;return t(this,function(t){switch(t.label){case 0:if(!this.keypair||!this.keypair.publicKey)throw new Error("Missing public key");return[4,this.cryptoAPI.subtle.exportKey("spki",this.keypair.publicKey)];case 1:return e=t.sent(),[2,new Uint8Array(e)]}})})},r.prototype.importPublicKey=function(r){return e(this,void 0,Promise,function(){var e;return t(this,function(t){switch(t.label){case 0:return this.keypair||(this.keypair={publicKey:void 0,privateKey:void 0}),this.keypair.publicKey||(this.keypair.publicKey=void 0),e=this.keypair,[4,this.cryptoAPI.subtle.importKey("spki",r,{name:this.keyParams.name,hash:this.keyParams.hash},!0,["encrypt"])];case 1:return e.publicKey=t.sent(),[2]}})})},r.prototype.exportKey=function(){return e(this,void 0,Promise,function(){var e,r,i;return t(this,function(t){switch(t.label){case 0:if(!this.keypair||!this.keypair.privateKey)throw new Error("Missing private key");if(!this.userKey)throw new Error("Missing user key");return e=this.cryptoAPI.getRandomValues(new Uint8Array(16)),[4,this.cryptoAPI.subtle.wrapKey("pkcs8",this.keypair.privateKey,this.userKey,{name:this.userKeyParams.name,iv:e})];case 1:return r=t.sent(),(i=new Uint8Array(e.byteLength+r.byteLength)).set(e,0),i.set(new Uint8Array(r),e.byteLength),[2,i]}})})},r.prototype.importKey=function(r){return e(this,void 0,Promise,function(){var e,i,n;return t(this,function(t){switch(t.label){case 0:if(e=r.slice(0,16),i=r.slice(16,r.byteLength),r.byteLength<16)throw new Error("Missing IV in rawKey");if(!this.userKey)throw new Error("Missing user key");return this.keypair||(this.keypair={publicKey:void 0,privateKey:void 0}),this.keypair.privateKey||(this.keypair.privateKey=void 0),n=this.keypair,[4,this.cryptoAPI.subtle.unwrapKey("pkcs8",i,this.userKey,{name:"AES-GCM",iv:e},{name:this.keyParams.name,hash:this.keyParams.hash},!0,["decrypt"])];case 1:return n.privateKey=t.sent(),[2]}})})},r.prototype.encrypt=function(r){return e(this,void 0,Promise,function(){return t(this,function(e){switch(e.label){case 0:return[4,this.cryptoAPI.subtle.encrypt(this.keyParams.name,this.keypair.publicKey,this.textEncoder.encode(r))];case 1:return[2,e.sent()]}})})},r.prototype.decrypt=function(r){return e(this,void 0,Promise,function(){var e=this;return t(this,function(t){switch(t.label){case 0:return[4,this.cryptoAPI.subtle.decrypt(this.keyParams.name,this.keypair.privateKey,r).then(function(t){return e.textDecoder.decode(t)})];case 1:return[2,t.sent()]}})})},r}();exports.default=r;
},{}],"B6dB":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function u(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,s)}l((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,a,o,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(a=(a=u.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){u.label=o[1];break}if(6===o[0]&&u.label<a[1]){u.label=a[1],a=o;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(o);break}a[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(s){o=[6,s],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./hex"),a=r(require("./key-manager"));function o(){var r=this;if(window.crypto&&window.crypto.subtle){var o=document.getElementById("message-output"),u=document.getElementById("password"),s=document.getElementById("generate-userkey"),l=document.getElementById("salt"),i=document.getElementById("public-key"),c=document.getElementById("private-key"),d=document.getElementById("reset"),y=document.getElementById("generate-keypair"),p=document.getElementById("export-keypair"),f=document.getElementById("import-keypair"),v={value:null,encrypted:null},b=new a.default(window.crypto),h=b.generateSalt();m(l,"input",function(e){32===l.value.length&&/[a-f0-9]{32}/.test(l.value)?(h=new Uint8Array((0,n.Decode)(l.value)),w("Loaded salt!")):w("Invalid salt: must be 32 hexadecimal characters")}),m(i,"input",function(e){i.value&&c.value?f.removeAttribute("disabled"):f.setAttribute("disabled","true")}),m(c,"input",function(e){i.value&&c.value?f.removeAttribute("disabled"):f.setAttribute("disabled","true")}),k(),m(d,"click",function(){k()}),m(s,"click",function(){return e(r,void 0,void 0,function(){var e;return t(this,function(t){switch(t.label){case 0:if(!(e=function(){if(!(u.value.length<8))return u.value;w("Password must be greater than 8 characters long")}()))return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,b.deriveUserKey("test@example.org",e,h)];case 2:return t.sent(),w("Generated user key"),y.removeAttribute("disabled"),[3,4];case 3:return w("Error: "+t.sent().message),[3,4];case 4:return[2]}})})}),m(y,"click",function(){return e(r,void 0,void 0,function(){var e;return t(this,function(t){switch(t.label){case 0:w("Generating keypair..."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,b.generateKeyPair()];case 2:return t.sent(),w("Generated keypair"),p.removeAttribute("disabled"),[3,4];case 3:return e=t.sent(),console.error("Generate",e.message),[3,4];case 4:return[2]}})})}),m(p,"click",function(a){return e(r,void 0,void 0,function(){var e,r,a;return t(this,function(t){switch(t.label){case 0:return b.hasKeyPair()?b.hasUserKey()?(v.value=(new Date).toString(),e=v,[4,b.encrypt(v.value)]):(w("Missing userKey for session, enter a password above, and click 'Generate User Keys'."),[2]):(w("Missing keypair for session, click 'Generate Keypair'."),[2]);case 1:e.encrypted=t.sent(),console.log("Secret: ",v),t.label=2;case 2:return t.trys.push([2,5,,6]),[4,b.exportKey()];case 3:return r=t.sent(),[4,b.exportPublicKey()];case 4:return a=t.sent(),i.value=(0,n.Encode)(a),c.value=(0,n.Encode)(r),f.removeAttribute("disabled"),w("Exported!"),[3,6];case 5:return w("Export Error:"+t.sent().message),[3,6];case 6:return[2]}})})}),m(f,"click",function(){return e(r,void 0,void 0,function(){var e,r,a,o;return t(this,function(t){switch(t.label){case 0:if(!b.hasUserKey())return w("Missing userKey for session"),[2];e=(0,n.Decode)(i.value),r=(0,n.Decode)(c.value),t.label=1;case 1:return t.trys.push([1,8,,9]),[4,b.importPublicKey(e)];case 2:return t.sent(),[4,b.importKey(r)];case 3:return t.sent(),b.hasKeyPair()?v.encrypted&&v.value?[4,b.decrypt(v.encrypted)]:[3,5]:[3,6];case 4:a=t.sent(),console.log("Secret Value: ",a),console.log("Secret Value Matches:",a===v.value),a?a!==v.value&&w("Error: secrets do not match, something went wrong"):w("Error: Could not decrypt secret"),t.label=5;case 5:return w("Imported!"),[3,7];case 6:w("Error: Could not import keys"),t.label=7;case 7:return[3,9];case 8:return o=t.sent(),console.log(o),w("Error: "+(o.message||o.name)),[3,9];case 9:return[2]}})})}),console.clear()}else console.error("Your browser does not support the Web Cryptography API! This page will not work.");function g(e,t){o.textContent=e,t&&(console.log(e),console.log(t))}function m(e,t,r){e.addEventListener(t,function(e){e.preventDefault(),g("Working...",null),r()})}function w(e){g(e,b.getInternalState())}function k(){h=b.generateSalt(),v.value=null,v.encrypted=null,u.value="",l.value=(0,n.Encode)(h),i.value="",c.value="",y.setAttribute("disabled","true"),p.setAttribute("disabled","true"),f.setAttribute("disabled","true"),w("Ready!")}}try{o()}catch(u){console.error(u)}
},{"./hex":"B0rW","./key-manager":"XCns"}]},{},["B6dB"], null)
//# sourceMappingURL=/csb-sld7c/src.4df30fa6.js.map